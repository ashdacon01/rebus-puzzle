<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Rebus Puzzle - Slideshow</title>
<link rel="stylesheet" href="style.css">

<style>
:root { overflow-x: hidden; width: 100%; }
html, body { margin: 0; padding: 0; width: 100vw !important; max-width: 100vw !important; overflow-x: hidden !important; position: relative; background: #b40e0e; }

.puzzle-page { opacity: 0; transition: opacity 0.3s ease-in-out; margin: 0; height: 100vh; background: #b40e0e; }
.puzzle-page.show { opacity: 1; }

.puzzle-page .puzzle-wrapper { display: flex; flex-direction: column; align-items: center; height: auto; padding: 20px; box-sizing: border-box; }
.puzzle-page .puzzle-tile { width: 680px; height: 480px; background: #0d2236; border-radius: 12px; border: 4px solid #00000040; overflow: hidden; padding: 0; }
.puzzle-page .puzzle-tile img { width: 100%; height: 100%; object-fit: cover; padding: 0; margin: 0; }

.puzzle-page .rounded-btn { background: #1f2327; color: white; border: 2px solid #00000080; padding: 8px 16px; border-radius: 10px; cursor: pointer; font-size: inherit; transition: 0.2s ease; }
.puzzle-page .rounded-btn:hover { background: #2b3238; transform: scale(1.05); }

.puzzle-page .nav-buttons { display: flex; gap: 12px; margin-top: 8px; margin-bottom: 5px; position: relative; z-index: 10; }
.puzzle-page #hintText { margin: 2px 0; min-height: 30px; display: flex; justify-content: center; align-items: center; }
.puzzle-page #hintBtn { margin-top: 12px; }
.puzzle-page .hint-container { height: 35px; display: flex; justify-content: center; align-items: center; margin-top: 5px; }
.puzzle-page #result { font-size: 1.4rem; min-height: 1.2em; text-align: center; }

.puzzle-page .bottom-buttons { position: fixed; bottom: 20px; right: 20px; display: flex; flex-direction: row; gap: 10px; z-index: 2000; }
.puzzle-page .bottom-buttons button { padding: 6px 14px; font-size: inherit; border-radius: 6px; width: 100px; }

.puzzle-page .quit-popup { position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.7); display:flex; justify-content:center; align-items:center; z-index: 1000; }
.puzzle-page .quit-dialog { background: #1f2327; padding: 30px; border-radius: 12px; text-align: center; color: white; min-width: 300px; }

.medium-popup { position: fixed; top:0; left:0; right:0; bottom:0; width:100%; height:100%; background: rgba(0,0,0,0.65); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); display:flex; justify-content:center; align-items:center; z-index:5000; color:white; font-size:clamp(2.5rem,8vw,6rem); font-weight:bold; text-shadow:3px 3px 8px black; cursor:pointer; text-align:center; white-space:normal; word-break:break-word; max-width:92%; margin:0 auto; padding:20px; box-sizing:border-box;}

/* Ready popup CSS */
.ready-popup {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.65);
    backdrop-filter: blur(10px);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 10000;
}

.ready-dialog {
    background: #1f2327;
    padding: 40px;
    border-radius: 12px;
    text-align: center;
    color: white;
}

.ready-dialog p {
    font-size: 2rem;
    margin-bottom: 20px;
}

.ready-dialog button {
    font-size: 1.5rem;
    padding: 12px 24px;
    border-radius: 8px;
    border: none;
    background: #2b3238;
    color: white;
    cursor: pointer;
    transition: 0.2s;
}

.ready-dialog button:hover {
    transform: scale(1.05);
    background: #3a4147;
}
</style>
</head>
<body>

<!-- READY POPUP WITH ADDED QUIT BUTTON -->
<div id="readyPopup" class="ready-popup">
    <div class="ready-dialog">
        <p>Are you ready to play?</p>

        <div style="display:flex; flex-direction:column; gap:15px;">
            <button id="startGameBtn">Start</button>
            <button id="quitReadyBtn" style="background:#5a1f1f;">Quit</button>
        </div>
    </div>
</div>

<div class="puzzle-page">
<div class="puzzle-wrapper">
    <h1 id="puzzleTitle">Puzzle</h1>

    <div class="puzzle-tile">
        <img id="puzzleImage" src="" alt="Rebus Image">
    </div>

    <div class="nav-buttons">
        <button id="prevImg" class="rounded-btn">⏮ Prev</button>
        <button id="nextImg" class="rounded-btn">Next ⏭</button>
    </div>

    <button id="hintBtn" class="rounded-btn">Show Hint</button>
    <div class="hint-container">
        <p id="hintText"></p>
    </div>

    <div id="result"></div>

    <div class="bottom-buttons">
        <button class="back-btn" onclick="transitionBack()">Back</button>
        <button class="quit-btn" onclick="quitGame()">Quit</button>
    </div>
</div>

<div id="answerPopup" class="medium-popup" style="display:none;"></div>
</div>

<script>
function getQueryParam(param) {
    const urlParams = new URLSearchParams(window.location.search);
    return urlParams.get(param);
}

function quitGame() {
    if(document.querySelector(".quit-popup")) return;
    const box = document.createElement("div");
    box.className = "quit-popup";
    box.innerHTML = `<div class="quit-dialog">
        <p>Are you sure you want to quit?</p>
        <div class="quit-buttons">
            <button id="yesQuit">Yes</button>
            <button id="noQuit">No</button>
        </div>
    </div>`;
    document.body.appendChild(box);
    document.getElementById("yesQuit").onclick = () => { document.querySelector(".puzzle-page").classList.remove("show"); setTimeout(()=>window.location.href="categories.html",300); };
    document.getElementById("noQuit").onclick = () => box.remove();
}

function transitionBack() {
    document.querySelector(".puzzle-page").classList.remove("show");
    setTimeout(() => window.location.href="categories.html", 300);
}

function triggerConfetti() {
    const canvas = document.createElement("canvas");
    canvas.id = "confettiCanvas";
    canvas.style.position="absolute"; canvas.style.top=0; canvas.style.left=0; canvas.style.width="100%"; canvas.style.height="100%"; canvas.style.pointerEvents="none"; canvas.style.zIndex=10;
    const answerPopup = document.getElementById("answerPopup");
    answerPopup.appendChild(canvas);
    const ctx = canvas.getContext("2d");
    const pieces=[];
    for(let i=0;i<150;i++){ pieces.push({ x: Math.random()*canvas.clientWidth, y: Math.random()*-50, size:5+Math.random()*8, speed:2+Math.random()*4 }); }
    function update() {
        ctx.clearRect(0,0,canvas.width,canvas.height);
        pieces.forEach(p=>{ p.y+=p.speed; ctx.fillStyle=`hsl(${Math.random()*360},100%,50%)`; ctx.fillRect(p.x,p.y,p.size,p.size); });
        requestAnimationFrame(update);
    }
    canvas.width = answerPopup.clientWidth;
    canvas.height = answerPopup.clientHeight;
    update();
    setTimeout(()=>canvas.remove(),2500);
}

function showMediumPopup() {
    const pop = document.createElement("div");
    pop.className = "medium-popup";
    pop.textContent = "Get ready for more puzzles!";
    pop.onclick = () => pop.remove();
    document.body.appendChild(pop);
}

document.addEventListener("DOMContentLoaded",()=>{
    const readyPopup = document.getElementById("readyPopup");
    const startBtn = document.getElementById("startGameBtn");
    const quitReadyBtn = document.getElementById("quitReadyBtn");
    const puzzlePage = document.querySelector(".puzzle-page");

    startBtn.addEventListener("click",()=>{
        readyPopup.style.display = "none";
        puzzlePage.classList.add("show");
        initGame();
    });

    // NEW READY POPUP QUIT
    quitReadyBtn.addEventListener("click", ()=>{
        window.location.href = "categories.html";
    });
});

function initGame(){
    const category = getQueryParam("category") || "Brand Logos";
    document.getElementById("puzzleTitle").textContent = category;

    const puzzleSets = {

        /* ----------------------
           BRAND LOGOS (original)
        -----------------------*/
        "Brand Logos": [
            { img:"images/brand_apple.png", answer:"Apple" },
            { img:"images/brand_disneyland.png", answer:"Disneyland" },
            { img:"images/brand_fedex.png", answer:"FedEx" },
            { img:"images/brand_firefox.png", answer:"Firefox" },
            { img:"images/brand_nike.png", answer:"Nike" },
            { img:"images/brand_oreo.png", answer:"Oreo" },
            { img:"images/brand_python.png", answer:"Python" },
            { img:"images/brand_sprite.png", answer:"Sprite" },
            { img:"images/brand_starbucks.png", answer:"Starbucks" },
            { img:"images/brand_twitter.png", answer:"Twitter" },
            { img:"images/brand_facebook.png", answer:"Facebook" },
            { img:"images/brand_lego.png", answer:"Lego" },
            { img:"images/brand_paypal.png", answer:"PayPal" },
            { img:"images/brand_pepsi.png", answer:"Pepsi" },
            { img:"images/brand_pinterest.png", answer:"Pinterest" },
            { img:"images/brand_redbull.png", answer:"RedBull" },
            { img:"images/brand_samsung.png", answer:"Samsung" },
            { img:"images/brand_shell.png", answer:"Shell" },
            { img:"images/brand_snapchat.png", answer:"Snapchat" },
            { img:"images/brand_subway.png", answer:"Subway" },
            { img:"images/brand_fujifilm.png", answer:"Fujifilm" },
            { img:"images/brand_rolex.png", answer:"Rolex" },
            { img:"images/brand_intel.png", answer:"Intel" },
            { img:"images/brand_cornetto.png", answer:"Cornetto" },
            { img:"images/brand_drpepper.png", answer:"Dr Pepper" },
            { img:"images/brand_lamborgini.png", answer:"Lamborghini" },
            { img:"images/brand_microsoft.png", answer:"Microsoft" },
            { img:"images/brand_lipton.png", answer:"Lipton" },
            { img:"images/brand_mitsubishi.png", answer:"Mitsubishi" },
            { img:"images/brand_hermes.png", answer:"Hermès" }
        ],

        "Movies": [
            { img:"images/ghost_rider.png", answer:"Ghost Rider" },
            { img:"images/bee_movie.png", answer:"Bee Movie" },
            { img:"images/lion_king.png", answer:"Lion King" },
            { img:"images/spider_man.png", answer:"Spider Man" },
            { img:"images/ant_man.png", answer:"Ant Man" },
            { img:"images/king_of_speech.png", answer:"King Of Speech" },
            { img:"images/car_2.png", answer:"Car 2" },
            { img:"images/girl_in_the_next_door.png", answer:"Girl In The Next Door" },
            { img:"images/rocket_man.png", answer:"Rocket Man" },
            { img:"images/ice_man.png", answer:"Ice Man" },

            { img:"images/ghost_call.png", answer:"Ghost Call" },
            { img:"images/back_to_future.png", answer:"Back To Future" },
            { img:"images/karate_kid.png", answer:"Karate Kid" },
            { img:"images/a_beautiful_mind.png", answer:"A Beautiful Mind" },
            { img:"images/social_web.png", answer:"Social Web" },
            { img:"images/she_is_gone.png", answer:"She Is Gone" },
            { img:"images/iniside_out.png", answer:"Iniside Out" },
            { img:"images/no_county_for_oldman.png", answer:"No County For Oldman" },
            { img:"images/parasite.png", answer:"Parasite" },
            { img:"images/blade_runner.png", answer:"Blade Runner" },

            { img:"images/pirate_adventure.png", answer:"Pirate Adventure" },
            { img:"images/she's_reading_part_2.png", answer:"She's Reading Part 2" },
            { img:"images/7_king_speech.png", answer:"7 King Speech" },
            { img:"images/rocketman_to_star.png", answer:"Rocketman To Star" },
            { img:"images/charlie_chocolate_factory.png", answer:"Charlie Chocolate Factory" },
            { img:"images/seven_ghost_in_the_house.png", answer:"Seven Ghost In The House" },
            { img:"images/eye_love_alien.png", answer:"Eye Love Alien" },
            { img:"images/3_alien_in_the_space.png", answer:"3 Alien In The Space" },
            { img:"images/eye_love_small.png", answer:"Eye Love Small" },
            { img:"images/now_you_see_me.png", answer:"Now You See Me" }

        ],
        "Music": [
            { img:"images/movie_avengers.png", answer:"Avengers" },

        ],
        "Idioms": [
            { img:"images/movie_avengers.png", answer:"Avengers" },
        ],
        "Animals": [
            { img:"images/movie_avengers.png", answer:"Avengers" },
        ],
        "Food": [
            { img:"images/movie_avengers.png", answer:"Avengers" },
        ]
    };

    const imagesArray = puzzleSets[category];
    let currentIndex = 0;

    const puzzleImage = document.getElementById("puzzleImage");
    const hintBtn = document.getElementById("hintBtn");
    const hintText = document.getElementById("hintText");
    const answerPopup = document.getElementById("answerPopup");

    function showImage(index){
        if(index<0) index=0;
        if(index>=imagesArray.length) index=imagesArray.length-1;
        currentIndex=index;
        puzzleImage.src = imagesArray[currentIndex].img;
        hintText.style.display="none";
        hintText.textContent="";
        hintBtn.disabled=false;
    }

    document.getElementById("nextImg").addEventListener("click",()=>showImage(currentIndex+1));
    document.getElementById("prevImg").addEventListener("click",()=>showImage(currentIndex-1));

    hintBtn.addEventListener("click",()=>{
        hintBtn.disabled=true;
        answerPopup.style.display="flex";
        answerPopup.textContent = `Answer: ${imagesArray[currentIndex].answer}`;

        if(currentIndex===imagesArray.length-1){
            setTimeout(()=>{
                triggerConfetti();
                setTimeout(()=>{ answerPopup.style.display="none"; showMediumPopup(); }, 1800);
            },1000);
        }
    });

    answerPopup.addEventListener("click",()=>{ answerPopup.style.display="none"; });

    showImage(0);
}
</script>
</body>
</html>
