<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Rebus Puzzle - Slideshow</title>
<link rel="stylesheet" href="style.css">

<style>
/* ==== UPDATED BACKGROUND & TILE GLOW + PARTICLES ==== */
html, body {
    margin: 0;
    padding: 0;
    width: 100%;
    min-height: 100%;
    overflow-x: hidden;
    background: linear-gradient(135deg, #b40e0e, #ff4d4d);
    animation: gradientShift 15s ease-in-out infinite;
    position: relative;
}

@keyframes gradientShift {
    0% { background: linear-gradient(135deg, #b40e0e, #ff4d4d); }
    50% { background: linear-gradient(135deg, #ff1f1f, #ff8080); }
    100% { background: linear-gradient(135deg, #b40e0e, #ff4d4d); }
}

#particleCanvas {
    position: fixed;
    top:0;
    left:0;
    width:100%;
    height:100%;
    z-index: 0;
    pointer-events: none;
}

.puzzle-page { opacity: 0; transition: opacity 0.3s ease-in-out; margin: 0; height: 100vh; position: relative; z-index: 1; }
.puzzle-page.show { opacity: 1; }
.puzzle-page .puzzle-wrapper { display: flex; flex-direction: column; align-items: center; height: auto; padding: 20px; box-sizing: border-box; }

/* ==== TV TILE DESIGN ==== */
.puzzle-page .puzzle-tile {
    width: 580px; 
    height: 380px; 
    background: #111; 
    border-radius: 20px; 
    border: 8px solid #333;
    box-shadow: 0 0 30px rgba(0,0,0,0.7), inset 0 0 30px rgba(255,255,255,0.05);
    position: relative;
    overflow: visible; /* allow feet to show */
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}
.puzzle-page .puzzle-tile:hover {
    transform: scale(1.02);
    box-shadow: 0 0 50px rgba(255, 255, 255, 0.6), inset 0 0 40px rgba(255,255,255,0.08);
}

/* SCREEN IMAGE */
.puzzle-page .puzzle-tile img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    padding: 0; 
    margin: 0;
    border-radius: 12px;
}

/* GLARE ON TV */
.puzzle-page .puzzle-tile::before {
    content: "";
    position: absolute;
    top: 10%;
    left: 10%;
    width: 80%;
    height: 80%;
    border-radius: 12px;
    background: linear-gradient(145deg, rgba(255,255,255,0.1), rgba(255,255,255,0));
    pointer-events: none;
}

/* TV STAND */
.puzzle-page .puzzle-tile::after {
    content: "";
    position: absolute;
    bottom: -20px;
    left: 50%;
    transform: translateX(-50%);
    width: 100px;
    height: 20px;
    background: #222;
    border-radius: 6px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.5);
}

/* RETRO TV FEET */
.puzzle-page .puzzle-tile .tv-foot-left,
.puzzle-page .puzzle-tile .tv-foot-right {
    position: absolute;
    bottom: -35px; 
    width: 25px;
    height: 15px;
    background: #333;
    border-radius: 3px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.5);
    transform: rotate(-2deg);
}
.puzzle-page .puzzle-tile .tv-foot-right {
    right: 25%;
    transform: rotate(2deg);
}
.puzzle-page .puzzle-tile .tv-foot-left {
    left: 25%;
}

/* POWER LED */
.puzzle-page .puzzle-tile .power-led {
    position: absolute;
    bottom: 12px;
    right: 16px;
    width: 10px;
    height: 10px;
    background: #0f0;
    border-radius: 50%;
    box-shadow: 0 0 8px #0f0, 0 0 12px #0f0;
    animation: ledPulse 1.5s infinite alternate;
}

@keyframes ledPulse {
    0% { transform: scale(1); opacity: 0.8; }
    100% { transform: scale(1.4); opacity: 1; }
}

/* BUTTONS, nav, popup, etc. remain unchanged */
.puzzle-page .rounded-btn { background: #1f2327; color: white; border: 2px solid #00000080; padding: 8px 16px; border-radius: 10px; cursor: pointer; font-size: inherit; transition: 0.2s ease; }
.puzzle-page .rounded-btn:hover { background: #2b3238; transform: scale(1.05); }
.puzzle-page .nav-buttons { display: flex; gap: 12px; margin-top: 8px; margin-bottom: 5px; position: relative; z-index: 10; flex-wrap: wrap; justify-content: center; }
.puzzle-page #hintText { margin: 2px 0; min-height: 30px; display: flex; justify-content: center; align-items: center; }
.puzzle-page #hintBtn { margin-top: 12px; }
.puzzle-page .hint-container { height: 35px; display: flex; justify-content: center; align-items: center; margin-top: 5px; }
.puzzle-page #result { font-size: 1.4rem; min-height: 1.2em; text-align: center; }
.puzzle-page .bottom-buttons { position: fixed; bottom: 20px; right: 20px; display: flex; flex-direction: row; gap: 10px; z-index: 2000; }
.puzzle-page .bottom-buttons button { padding: 6px 14px; font-size: inherit; border-radius: 6px; width: 100px; }
.puzzle-page .quit-popup { position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.7); display:flex; justify-content:center; align-items:center; z-index: 1000; }
.puzzle-page .quit-dialog { background: #1f2327; padding: 30px; border-radius: 12px; text-align: center; color: white; min-width: 300px; }

.medium-popup { position: fixed; top:0; left:0; width:100vw; height:100vh; background: rgba(0,0,0,0.65); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); display:flex; justify-content:center; align-items:center; z-index:5000; color:white; font-size:clamp(2.5rem,8vw,6rem); font-weight:bold; text-shadow:3px 3px 8px black; cursor:pointer; text-align:center; white-space: pre-wrap; word-break:break-word; padding:20px; box-sizing:border-box; }

.ready-popup { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; margin: 0; padding: 0; background: rgba(0,0,0,0.65); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); display: flex; justify-content: center; align-items: center; z-index: 5000; }

.ready-dialog { background: #1f2327; padding: 40px; border-radius: 12px; text-align: center; color: white; }

.ready-dialog p { font-size: 2rem; margin-bottom: 20px; }

.ready-dialog button { font-size: 1.5rem; padding: 12px 24px; border-radius: 8px; border: none; background: #2b3238; color: white; cursor: pointer; transition: 0.2s; }

.ready-dialog button:hover { transform: scale(1.05); background: #3a4147; }

.correct-btn, .wrong-btn { padding: 8px 12px; border-radius: 8px; border: 2px solid #00000060; cursor: pointer; font-size: 0.95rem; }
.correct-btn { background: #1f7a1f; color: white; }
.correct-btn:hover { transform: scale(1.03); }
.wrong-btn { background: #7a1f1f; color: white; }
.wrong-btn:hover { transform: scale(1.03); }

/* ==== FULLSCREEN BUTTON ==== */#fullscreenBtn {
    position: fixed;
    top: 16px;
    right: 16px;
    z-index: 7000;
    background: transparent;        /* fully transparent */
    color: white;                   /* icon color */
    border: none;                   /* remove border */
    border-radius: 10px;
    padding: 8px 14px;
    font-size: 1rem;
    cursor: pointer;
    transition: 0.2s;
}

#fullscreenBtn:hover {
    background: rgba(255, 255, 255, 0.1); /* subtle hover effect */
    transform: scale(1.05);
}

</style>
</head>
<body>

<canvas id="particleCanvas"></canvas>

<div id="readyPopup" class="ready-popup">
    <div class="ready-dialog">
        <p>Are you ready to play?</p>
        <div style="display:flex; flex-direction:column; gap:15px;">
            <button id="startGameBtn">Start</button>
            <button id="quitReadyBtn" style="background:#5a1f1f;">Quit</button>
        </div>
    </div>
</div>

<div class="puzzle-page">
<div class="puzzle-wrapper">

    <!-- FULLSCREEN BUTTON -->
    <button id="fullscreenBtn">⛶</button>

    <h1 id="puzzleTitle">Puzzle</h1>

    <div class="puzzle-tile" style="position:relative;">
        <img id="puzzleImage" src="" alt="Rebus Image">
        <div class="power-led"></div>
        <div class="tv-foot-left"></div>
        <div class="tv-foot-right"></div>

        <!-- SCORE BOX (inside tile) -->
        <div id="scoreBox" style="position:absolute; top:12px; right:12px; z-index:500; padding:6px 12px; font-size:1rem; border-radius:6px; border:2px solid #00000080; background:#1f2327; color:white;">
            Score: 0
        </div>
    </div>

    <div class="nav-buttons">
        <button id="correctBtn" class="correct-btn">✔Correct</button>
        <button id="wrongBtn" class="wrong-btn">✖Wrong</button>
    </div>

    <div class="nav-buttons">
        <button id="prevImg" class="rounded-btn">⏮ Prev</button>
        <button id="nextImg" class="rounded-btn">Next ⏭</button>
    </div>

    <button id="hintBtn" class="rounded-btn">Show Hint</button>
    <div class="hint-container">
        <p id="hintText"></p>
    </div>

    <div id="result"></div>

    <div class="bottom-buttons">
        <button class="back-btn" onclick="transitionBack()">Back</button>
        <button class="quit-btn" onclick="quitGame()">Quit</button>
    </div>
</div>

<div id="answerPopup" class="medium-popup" style="display:none;"></div>


<div id="playMorePopup" class="ready-popup" style="display:none;">
    <div class="ready-dialog">
        <p>Do you want to play more?</p>
        <div style="display:flex; flex-direction:column; gap:15px;">
            <button onclick="window.location.href='categories.html'">Category</button>
            <button onclick="window.location.href='index.html'" style="background:#5a1f1f;">Quit</button>
        </div>
    </div>
</div>

<script>
// PARTICLES
const canvas = document.getElementById("particleCanvas");
const ctx = canvas.getContext("2d");
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;
const particles = [];
for(let i=0;i<120;i++){
    particles.push({ x: Math.random()*canvas.width, y: Math.random()*canvas.height, r: 1+Math.random()*3, d: Math.random()*1 });
}
function drawParticles(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    ctx.fillStyle = "rgba(255,255,255,0.3)";
    particles.forEach(p=>{
        ctx.beginPath();
        ctx.arc(p.x,p.y,p.r,0,Math.PI*2,true);
        ctx.fill();
        p.y += 0.2 + p.d;
        if(p.y > canvas.height) p.y = 0;
    });
    requestAnimationFrame(drawParticles);
}
drawParticles();

// GET QUERY PARAM
function getQueryParam(param) {
    return new URLSearchParams(window.location.search).get(param);
}

// QUIT / BACK
function quitGame() {
    if(document.querySelector(".quit-popup")) return;
    const box = document.createElement("div");
    box.className = "quit-popup";
    box.innerHTML = `<div class="quit-dialog">
        <p>Are you sure you want to quit?</p>
        <div class="quit-buttons">
            <button id="yesQuit">Yes</button>
            <button id="noQuit">No</button>
        </div>
    </div>`;
    document.body.appendChild(box);
    document.getElementById("yesQuit").onclick = () => { document.querySelector(".puzzle-page").classList.remove("show"); setTimeout(()=>window.location.href="categories.html",300); };
    document.getElementById("noQuit").onclick = () => box.remove();
}

function transitionBack() {
    document.querySelector(".puzzle-page").classList.remove("show");
    setTimeout(() => window.location.href="categories.html", 300);
}

// FULLSCREEN BUTTON LOGIC
const fullscreenBtn = document.getElementById("fullscreenBtn");

fullscreenBtn.addEventListener("click", () => {
    if (!document.fullscreenElement) {
        document.documentElement.requestFullscreen();
    } else {
        document.exitFullscreen();
    }
});

// Hide/show fullscreen button on fullscreen change
document.addEventListener("fullscreenchange", () => {
    if (document.fullscreenElement) {
        fullscreenBtn.style.display = "none"; // hide button
    } else {
        fullscreenBtn.style.display = "block"; // show button
    }
});

// CONFETTI
function triggerConfetti() {
    const canvas = document.createElement("canvas");
    canvas.id = "confettiCanvas";
    canvas.style.position="absolute"; canvas.style.top=0; canvas.style.left=0; canvas.style.width="100%"; canvas.style.height="100%"; canvas.style.pointerEvents="none"; canvas.style.zIndex=10;
    const answerPopup = document.getElementById("answerPopup");
    answerPopup.appendChild(canvas);
    const ctx = canvas.getContext("2d");
    const pieces=[]; for(let i=0;i<150;i++){ pieces.push({ x: Math.random()*canvas.clientWidth, y: Math.random()*-50, size:5+Math.random()*8, speed:2+Math.random()*4 }); }
    function update() { ctx.clearRect(0,0,canvas.width,canvas.height); pieces.forEach(p=>{ p.y+=p.speed; ctx.fillStyle=`hsl(${Math.random()*360},100%,50%)`; ctx.fillRect(p.x,p.y,p.size,p.size); }); requestAnimationFrame(update); }
    canvas.width = answerPopup.clientWidth;
    canvas.height = answerPopup.clientHeight;
    update();
    setTimeout(()=>canvas.remove(),2500);
}

// SHOW MEDIUM / PLAY MORE POPUP
function showMediumPopup(){
    document.getElementById("playMorePopup").style.display="flex";
}

// READY POPUP
document.addEventListener("DOMContentLoaded",()=>{
    const readyPopup = document.getElementById("readyPopup");
    const startBtn = document.getElementById("startGameBtn");
    const quitReadyBtn = document.getElementById("quitReadyBtn");
    const puzzlePage = document.querySelector(".puzzle-page");

    startBtn.addEventListener("click",()=>{
        readyPopup.style.display = "none";
        puzzlePage.classList.add("show");
        initGame();
    });

    quitReadyBtn.addEventListener("click", ()=>{ window.location.href = "categories.html"; });
});

// INIT GAME
function initGame(){
    const category = getQueryParam("category") || "Brand Logos";
    document.getElementById("puzzleTitle").textContent = category;

    const puzzleSets = {
        "Brand Logos": [
            { img:"images/brand_apple.png", answer:"Apple" },
            { img:"images/brand_disneyland.png", answer:"Disneyland" },
        ]
    };

    const imagesArray = puzzleSets[category];
    let currentIndex = 0;
    let score = 0;
    let hintPressed = false;

    const puzzleImage = document.getElementById("puzzleImage");
    const hintBtn = document.getElementById("hintBtn");
    const answerPopup = document.getElementById("answerPopup");
    const scoreBox = document.getElementById("scoreBox");

    const nextBtn = document.getElementById("nextImg");
    const prevBtn = document.getElementById("prevImg");
    const correctBtn = document.getElementById("correctBtn");
    const wrongBtn = document.getElementById("wrongBtn");

    const correctSound = new Audio("sounds/correct.mp3");
    const wrongSound = new Audio("sounds/wrong.mp3");
    const finishSound = new Audio("sounds/finishes.mp3");

    function showImage(index){
        if(index<0) index=0;
        if(index>=imagesArray.length) index=imagesArray.length-1;
        currentIndex=index;
        puzzleImage.src = imagesArray[currentIndex].img;
        hintBtn.disabled=false;
        hintPressed=false;
        nextBtn.disabled = true;
    }

    nextBtn.addEventListener("click",()=>showImage(currentIndex+1));
    prevBtn.addEventListener("click",()=>showImage(currentIndex-1));

    correctBtn.addEventListener("click", () => {
    score++;
    scoreBox.textContent = "Score: " + score;

    nextBtn.disabled = false;
    hintPressed = true;

    if(currentIndex === imagesArray.length -1){
        answerPopup.style.display = "flex";
        answerPopup.textContent = `✔Correct!`; 
        triggerConfetti();
        finishSound.play();
        setTimeout(()=>{ answerPopup.style.display="none"; showMediumPopup(); }, 1800);
    } else {
        answerPopup.style.display = "flex";
        answerPopup.textContent = `✔Correct!`; 
        correctSound.play();
    }
});

    wrongBtn.addEventListener("click", () => {
        answerPopup.style.display = "flex";
        answerPopup.textContent = `✖ Wrong!\nTry again.`;
        wrongSound.play();
    });

    hintBtn.addEventListener("click",()=>{
        hintBtn.disabled=true;
        hintPressed=true;
        nextBtn.disabled = false;

        answerPopup.style.display = "flex";
        answerPopup.textContent = `Answer: ${imagesArray[currentIndex].answer}`;

        if(currentIndex===imagesArray.length-1){
            triggerConfetti();
            finishSound.play();
            setTimeout(()=>{ answerPopup.style.display="none"; showMediumPopup(); },5000);
        }
    });

    answerPopup.addEventListener("click",()=>{ answerPopup.style.display="none"; });

    showImage(0);
}
</script>
</body>
</html>
